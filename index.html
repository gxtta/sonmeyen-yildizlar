<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sönmeyen Yıldızlar Anıtı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; overflow: hidden; background-color: #020205; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        
        #tooltip {
            position: absolute; display: none; background: rgba(20, 10, 20, 0.90); 
            border: 1px solid rgba(255, 100, 150, 0.3); backdrop-filter: blur(8px);
            padding: 10px 14px; border-radius: 8px; pointer-events: none; z-index: 10;
            box-shadow: 0 0 15px rgba(255, 50, 100, 0.3); transition: opacity 0.2s ease;
        }

        #detail-panel {
            position: absolute; right: -450px; top: 0; width: 450px; height: 100%;
            background: rgba(15, 10, 20, 0.95); backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 100, 150, 0.2); padding: 40px 30px;
            transition: right 0.4s cubic-bezier(0.19, 1, 0.22, 1); z-index: 20; overflow-y: auto;
        }
        #detail-panel.active { right: 0; }
        .glow-text { text-shadow: 0 0 15px rgba(255, 200, 220, 0.8); }
        .btn-primary { background: linear-gradient(135deg, #db2777 0%, #be185d 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(219, 39, 119, 0.4); }
        #loading {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #020205;
            display: flex; justify-content: center; align-items: center; z-index: 50;
            transition: opacity 1.5s ease; flex-direction: column;
        }
        .note-card { background: rgba(255, 255, 255, 0.05); border-left: 3px solid #ec4899; padding: 15px; margin-bottom: 10px; border-radius: 0 8px 8px 0; font-style: italic; color: #fce7f3; font-size: 0.9rem; }
        /* Mobil uyum için */
        @media (max-width: 600px) { #detail-panel { width: 100%; right: -100%; } }
    </style>
</head>
<body>
    <div class="absolute top-0 left-0 w-full p-8 z-10 bg-gradient-to-b from-black via-black/60 to-transparent pointer-events-none">
        <h1 class="text-4xl md:text-5xl font-thin tracking-[0.2em] text-pink-50 glow-text mb-3">SÖNMEYEN YILDIZLAR</h1>
        <p class="text-pink-200/80 text-sm md:text-base max-w-3xl leading-relaxed font-light">
            Her bir parlayan kalp, aramızdan alınan bir kadının anısını taşır.<br>
            <span class="text-xs text-pink-400/60 mt-3 block font-mono">Veriler günlük olarak Anıt Sayaç'tan güncellenmektedir.</span>
        </p>
    </div>
    <div id="tooltip"><p class="text-white font-bold text-sm" id="tooltip-name">İsim</p></div>
    <div id="detail-panel">
        <button id="close-panel" class="absolute top-6 right-6 text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
        <div class="mt-8 mb-8 text-center">
            <h2 class="text-3xl font-bold text-white mb-2" id="panel-name">İsim Soyisim</h2>
            <p class="text-pink-400 font-mono text-xs uppercase" id="panel-date">...</p>
        </div>
        <div class="bg-white/5 rounded-xl p-6 border border-white/10 mb-6">
            <h3 class="text-pink-100 font-semibold text-lg mb-3">Anı Defteri</h3>
            <textarea id="user-note-input" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-sm text-white focus:border-pink-500 outline-none mb-3" rows="4" placeholder="Bir not bırakın..."></textarea>
            <button id="btn-save-note" class="btn-primary w-full py-2.5 rounded-lg text-white font-medium text-sm">Anıyı Kaydet</button>
        </div>
        <div class="mt-6"><div id="notes-container" class="space-y-3"></div></div>
    </div>
    <div id="loading">
        <svg class="animate-pulse h-16 w-16 text-pink-600 mb-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        <p class="text-white tracking-[0.2em] text-sm uppercase font-bold">Yıldızlar Yükleniyor...</p>
    </div>
    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        const NoteSystem = {
            getNotes: function(starId) { const notes = localStorage.getItem(`star_note_${starId}`); return notes ? JSON.parse(notes) : []; },
            addNote: function(starId, text) {
                const notes = this.getNotes(starId);
                notes.unshift({ text: text, date: new Date().toLocaleDateString('tr-TR') });
                localStorage.setItem(`star_note_${starId}`, JSON.stringify(notes));
            }
        };

        const scene = new THREE.Scene(); scene.fog = new THREE.FogExp2(0x020205, 0.015);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000); camera.position.set(0, 40, 50);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight); renderer.outputEncoding = THREE.sRGBEncoding;
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.autoRotate = true; controls.autoRotateSpeed = 0.5;

        const parameters = { count: 6000, size: 1.5, radius: 70, branches: 3, spin: 1.5, randomness: 0.3, randomnessPower: 3, insideColor: '#ff9d00', outsideColor: '#0040ff' };
        let namesList = [];

        async function fetchNames() {
            try {
                // GitHub Actions tarafından üretilecek dosyayı okuyoruz
                const response = await fetch('anit_verileri.json');
                if (!response.ok) throw new Error('Veri yok');
                namesList = await response.json();
                if(namesList.length < 10) throw new Error('Veri az');
                generateGalaxy();
            } catch (error) {
                console.warn("Veri yüklenemedi, yedek veri kullanılıyor.");
                namesList = [
                    {name: "Özgecan Aslan", date: "11/02/2015"}, {name: "Emine Bulut", date: "18/08/2019"},
                    {name: "Ceren Özdemir", date: "03/12/2019"}, {name: "Şule Çet", date: "29/05/2018"},
                    {name: "Münevver Karabulut", date: "03/03/2009"}, {name: "Başak Cengiz", date: "09/11/2021"}
                ];
                // Dolgu verisi
                for(let i=0; i<100; i++) namesList.push({name: "İsimsiz Yıldız", date: "Tarih Bilinmiyor"});
                generateGalaxy();
            }
            setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 1000);
        }

        const heartTexture = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE2klEQVR42u2bzWtcVRjGn/fce2cmnUkyk5m00zaTj2ZNG9u0RYu0iCJoFRX8B0TcKSLu3LgSXLgQColLcSXEhQtF3IiiKIrWiiBttU3TJunHzGSSzL1z74uLmzY0zTSdmU7Te8/u/HjP+57zPOfMHWbOnDlz5syZsyA6wCA7F/m+WzYh/oYgLgh4g2JvENH8O88z5y5H0VzN7w3D0E8nZ0s/iYlLAo9A4A0AB0V4A4zXAZx3g3M3K0Xj55kzu8o+70iAt169sCPwgn8EwScC9AHorqF5R4y+UfT978YmN080e0/NA7yH7z+8K3S9lwX+AIAhAEHj9a5a7g+Vwuy3YxNbphu4n2rA97+6Y7fvea8C+FwM9gFwW6y9YtYqhfzXp89v/mEa91PygO/d2Luz7Abvi+ETCB4F0N9K76WwViycOzN5eaq+e+qegB/e3N0bdIPDAP4BcKhV/wXAr75n/njq/OaP5oB2J+B7N/YOlN3gcxG8D+BgK4VFi1+K+emTz9xcaKXuRjzgp5W9A24wDHCkZfrLAD5V8U/MzW+5vR26Fp+AP3pt73A1CN5k43iL9OcA/GLDPz47X5q81Y7dtQ7gJ5XhgeD2EADXKn1Rxd+9ML8l18rdNQFfXL53aGZ2+eNqEHwA4KhD+msA3q/6wZ2FhfnvFqNodq3cNS/BCi4t+qN//D39iSr+FIBB5+NfQ/AFAJ+r4s8WfX/yZrt016wD+J8rweALAB7xSH8VwCeq+LPTs8t/3m7t3h43YAX//DUzOln+RMC7AB70SH8DwCcqODJ9bmvhtur3HcB3f747vDxf/ERM7AHwuAP6SwA+tSbcXZpfmrpTuuuWCRb4c/P+6G+/p/eK4P0G6Q8DeFcVP53P5b87eWb+6nZq37EA/uKlH0cmV1Z3i+BeAEctpL8A4B018bOLheL3p6dK1263/p1rggWurAR73/394kgYhu8AOGqJ/gKADxT+6UoQ/PrH0vK1n05tbqrdHfEAvveXvc+urKz/BOBhC+k/B/C+iN2zWCj+/NvZtYVbaX/HAvjK6vKus+++s1wMgncBPGgh/XkA74rgkVKl/PPJ5+bmbqV9xy7BAo7fFf6i4p+4/T24o66A318+OLOy+omAH50Pvx3AW9aI+0rV0s/Hn1uaupX6d9QTcOXq6mAxCL7SOfHvq+L3FvL5706eLd/Y6Y3u6H8BC+s9+M31X6oB3//F3+g/X9z3/K0yOa53gJkzZ86cOXPmzJkzZ86cOZsG/wYAcG39fK7u2QAAAABJRU5ErkJggg==');
        let points = null; let starUserData = [];

        function generateGalaxy() {
            if(points) scene.remove(points);
            const count = Math.max(namesList.length, 4000);
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const colorInside = new THREE.Color(parameters.insideColor);
            const colorOutside = new THREE.Color(parameters.outsideColor);
            starUserData = [];

            for(let i=0; i<count; i++) {
                const i3 = i*3;
                const radius = Math.random() * parameters.radius;
                const spinAngle = radius * parameters.spin;
                const branchAngle = (i % parameters.branches) / parameters.branches * Math.PI * 2;
                const randomX = Math.pow(Math.random(), 3) * (Math.random()<0.5?1:-1) * 0.3 * radius;
                const randomY = Math.pow(Math.random(), 3) * (Math.random()<0.5?1:-1) * 0.3 * radius;
                const randomZ = Math.pow(Math.random(), 3) * (Math.random()<0.5?1:-1) * 0.3 * radius;

                positions[i3] = Math.cos(branchAngle+spinAngle)*radius + randomX;
                positions[i3+1] = randomY * 0.5;
                positions[i3+2] = Math.sin(branchAngle+spinAngle)*radius + randomZ;

                const mixedColor = colorInside.clone(); mixedColor.lerp(colorOutside, radius/parameters.radius);
                colors[i3]=mixedColor.r; colors[i3+1]=mixedColor.g; colors[i3+2]=mixedColor.b;
                
                const person = namesList[i % namesList.length];
                starUserData.push({ id: i, name: person.name || "Bilinmiyor", date: person.date || "Tarih Yok" });
            }
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            const material = new THREE.PointsMaterial({ size: parameters.size, sizeAttenuation: true, depthWrite: false, blending: THREE.AdditiveBlending, vertexColors: true, map: heartTexture, transparent: true, opacity: 0.85, alphaTest: 0.01 });
            points = new THREE.Points(geometry, material); scene.add(points);
        }

        // Raycaster & Events
        const raycaster = new THREE.Raycaster(); raycaster.params.Points.threshold = 1.5;
        const mouse = new THREE.Vector2(); let hoveredIndex = -1;
        
        const tooltip = document.getElementById('tooltip');
        const detailPanel = document.getElementById('detail-panel');
        
        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth)*2 - 1; mouse.y = -(e.clientY / window.innerHeight)*2 + 1;
            if(tooltip.style.display === 'block') { tooltip.style.left = (e.clientX+15)+'px'; tooltip.style.top = (e.clientY+15)+'px'; }
        });

        window.addEventListener('click', (e) => {
            if(e.target.closest('#detail-panel')) return;
            if(hoveredIndex !== -1) {
                const data = starUserData[hoveredIndex];
                document.getElementById('panel-name').innerText = data.name;
                document.getElementById('panel-date').innerText = data.date;
                document.getElementById('user-note-input').value = '';
                
                const container = document.getElementById('notes-container'); container.innerHTML = '';
                const notes = NoteSystem.getNotes(data.id);
                if(notes.length===0) container.innerHTML = '<p class="text-gray-500 text-xs italic">Not yok.</p>';
                else notes.forEach(n => container.innerHTML += `<div class="note-card"><p>"${n.text}"</p><span class="text-xs text-gray-500">${n.date}</span></div>`);
                
                document.getElementById('btn-save-note').onclick = () => {
                    const txt = document.getElementById('user-note-input').value.trim();
                    if(txt) { NoteSystem.addNote(data.id, txt); alert('Kaydedildi'); }
                };
                detailPanel.classList.add('active'); controls.autoRotate = false;
            }
        });

        document.getElementById('close-panel').onclick = () => { detailPanel.classList.remove('active'); controls.autoRotate = true; };
        window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

        function animate() {
            requestAnimationFrame(animate); controls.update();
            if(controls.autoRotate) { if(points) points.rotation.y += 0.0005; }
            raycaster.setFromCamera(mouse, camera);
            if(points) {
                const intersects = raycaster.intersectObject(points);
                if(intersects.length>0) {
                    const idx = intersects[0].index;
                    if(hoveredIndex !== idx && !detailPanel.classList.contains('active')) {
                        hoveredIndex = idx; document.body.style.cursor = 'pointer';
                        document.getElementById('tooltip-name').innerText = starUserData[idx].name;
                        tooltip.style.display = 'block';
                    }
                } else {
                    if(hoveredIndex !== -1) { hoveredIndex = -1; tooltip.style.display = 'none'; document.body.style.cursor = 'default'; }
                }
            }
            renderer.render(scene, camera);
        }

        fetchNames(); animate();
    </script>
</body>
</html>
