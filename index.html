<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÃ¶nmeyen YÄ±ldÄ±zlar - Dijital AnÄ±t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #050000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
        
        #tooltip { pointer-events: none; transform: translate(-50%, -150%); }
        
        #loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #050000; z-index: 50; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 1s ease;
        }
    </style>
</head>
<body class="antialiased text-gray-100">

    <canvas id="webgl" class="absolute top-0 left-0 w-full h-full z-0"></canvas>

    <!-- YÃ¼kleme EkranÄ± -->
    <div id="loading-overlay">
        <div class="w-16 h-16 border-4 border-red-900 border-t-pink-500 rounded-full animate-spin mb-4"></div>
        <p class="text-pink-300 text-sm tracking-widest animate-pulse">YILDIZLAR GÃœNCELLENÄ°YOR...</p>
    </div>

    <div class="relative z-10 pointer-events-none w-full h-screen">
        <div class="absolute top-0 left-0 p-8 pointer-events-auto">
            <h1 class="text-4xl font-light tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-red-600 drop-shadow-lg">
                SÃ–NMEYEN YILDIZLAR
            </h1>
            <p class="mt-2 text-sm text-red-100 opacity-70 max-w-md font-light">
                Her bir yÄ±ldÄ±z, aramÄ±zdan koparÄ±lan bir Ä±ÅŸÄ±ÄŸÄ± temsil eder. <br>
                Toplam <span id="total-count" class="font-bold text-white">...</span> can sonsuzluÄŸa karÄ±ÅŸtÄ±.
                <br><br>
                <span class="text-xs italic text-gray-500">Galakside gezinmek iÃ§in sÃ¼rÃ¼kleyin, detay iÃ§in tÄ±klayÄ±n.</span>
            </p>
        </div>

        <div id="tooltip" class="absolute hidden bg-black/80 border border-red-900/30 backdrop-blur-sm px-3 py-2 rounded text-sm shadow-[0_0_15px_rgba(255,0,0,0.2)] transition-opacity duration-200">
            <span id="tooltip-name" class="font-semibold text-pink-300">Ä°sim</span>
        </div>

        <div id="detail-panel" class="absolute top-0 right-0 h-full w-full md:w-[400px] bg-slate-900/80 backdrop-blur-xl border-l border-red-900/20 shadow-2xl pointer-events-auto transform transition-transform duration-500 translate-x-full flex flex-col">
            <button id="close-btn" class="absolute top-4 right-4 text-white/50 hover:text-white text-2xl">&times;</button>

            <div class="p-8 flex-1 overflow-y-auto">
                <div class="flex flex-col items-center mt-10">
                    <div class="w-24 h-24 rounded-full bg-gradient-to-tr from-pink-500 to-red-700 p-[2px] shadow-[0_0_30px_rgba(255,0,50,0.4)]">
                        <div class="w-full h-full bg-black rounded-full flex items-center justify-center">
                            <span class="text-3xl">ğŸ•Šï¸</span>
                        </div>
                    </div>
                    <h2 id="panel-name" class="mt-6 text-3xl font-bold text-center text-white">Ä°sim Soyisim</h2>
                    <p id="panel-date" class="mt-2 text-sm text-pink-300 uppercase tracking-wider">01.01.2024</p>
                </div>

                <hr class="border-white/10 my-8">

                <div>
                    <h3 class="text-lg font-medium text-pink-400 mb-4 flex items-center gap-2">
                        <span>ğŸ“’</span> AnÄ± Defteri
                    </h3>
                    <p class="text-xs text-gray-400 mb-3">Bu kiÅŸi iÃ§in bir not bÄ±rakÄ±n. Notunuz sadece sizin tarayÄ±cÄ±nÄ±zda saklanÄ±r.</p>
                    <textarea id="memory-input" rows="6" class="w-full bg-black/30 border border-white/10 rounded-lg p-4 text-sm text-gray-200 focus:outline-none focus:border-red-500/50 transition-colors resize-none placeholder-gray-600" placeholder="DuygularÄ±nÄ±zÄ± buraya yazÄ±n..."></textarea>
                    <div class="flex justify-end mt-3">
                        <button id="save-btn" class="px-6 py-2 bg-gradient-to-r from-red-900 to-pink-700 hover:from-red-800 hover:to-pink-600 text-white text-sm font-medium rounded shadow-lg transition-all transform active:scale-95">Kaydet</button>
                    </div>
                    <p id="save-msg" class="text-xs text-pink-400 mt-2 text-right hidden fade-in">Not kaydedildi.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- VERÄ° YÃ–NETÄ°MÄ° ---
        let namesList = []; 

        async function fetchNames() {
            try {
                const response = await fetch('anit_verileri.json');
                if (!response.ok) throw new Error('Veri dosyasÄ± bulunamadÄ±');
                
                const data = await response.json();
                namesList = data; 
                
                document.getElementById('total-count').innerText = namesList.length.toLocaleString();
                generateGalaxy();
                
                const loading = document.getElementById('loading-overlay');
                loading.style.opacity = '0';
                setTimeout(() => loading.style.display = 'none', 1000);

            } catch (error) {
                console.warn("Yedek veriler kullanÄ±lÄ±yor.", error);
                namesList = [
                    {name: "Emine Bulut", date: "18.08.2019"}, {name: "Ã–zgecan Aslan", date: "11.02.2015"}, 
                    {name: "Åule Ã‡et", date: "29.05.2018"}, {name: "Ceren Ã–zdemir", date: "03.12.2019"}
                ];
                for(let i=0; i<2000; i++) namesList.push({name: "Ä°simsiz YÄ±ldÄ±z", date: "Tarih Bilinmiyor"});
                
                document.getElementById('total-count').innerText = namesList.length.toLocaleString();
                generateGalaxy();
                document.getElementById('loading-overlay').style.display = 'none';
            }
        }

        function createHeartTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.moveTo(16, 28); ctx.bezierCurveTo(16, 26, 4, 18, 4, 12);
            ctx.bezierCurveTo(4, 6, 10, 4, 16, 10); ctx.bezierCurveTo(22, 4, 28, 6, 28, 12);
            ctx.bezierCurveTo(28, 18, 16, 26, 16, 28);
            ctx.fill();
            ctx.shadowBlur = 4; ctx.shadowColor = "white"; ctx.fill();
            return new THREE.CanvasTexture(canvas);
        }

        const canvas = document.querySelector('canvas.webgl');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2('#050000', 0.03);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.x = 0; camera.position.y = 4; camera.position.z = 6;

        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('webgl'), alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.dampingFactor = 0.05;
        controls.autoRotate = true; controls.autoRotateSpeed = 0.5;

        // --- GALAKSÄ° AYARLARI ---
        const parameters = {
            size: 0.15,
            radius: 8, // Temel yarÄ±Ã§ap
            branches: 4, 
            spin: 1.2,
            randomness: 0.5,
            randomnessPower: 3,
            insideColor: '#ffc0cb',
            outsideColor: '#8a0000'
        };

        let geometry = null;
        let points = null;

        const generateGalaxy = () => {
            if(namesList.length === 0) return;

            // Count artÄ±k JSON'daki kiÅŸi sayÄ±sÄ± kadar
            const count = namesList.length;

            geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const nameIndices = new Float32Array(count);

            const colorInside = new THREE.Color(parameters.insideColor);
            const colorOutside = new THREE.Color(parameters.outsideColor);

            for(let i = 0; i < count; i++) {
                const i3 = i * 3;

                // --- MERKEZDEN DIÅA DOÄRU BÃœYÃœME MANTIÄI ---
                // i arttÄ±kÃ§a radius artar. 
                // i / count oranÄ± 0 ile 1 arasÄ±ndadÄ±r.
                // Math.pow ile merkezdeki yoÄŸunluÄŸu koruyoruz.
                // radiusFactor: YÄ±ldÄ±zÄ±n galaksi iÃ§indeki gÃ¶receli konumu (0: merkez, 1: en dÄ±ÅŸ)
                const radiusFactor = Math.pow(i / count, 0.7); // 0.7 Ã¼ssÃ¼ dÄ±ÅŸa doÄŸru yumuÅŸak daÄŸÄ±lÄ±m saÄŸlar
                
                // YarÄ±Ã§apÄ± kiÅŸi sayÄ±sÄ±na gÃ¶re dinamik belirle ama gÃ¶rseli bozma
                // EÄŸer kiÅŸi sayÄ±sÄ± Ã§oksa galaksi biraz daha geniÅŸlesin
                const maxRadius = parameters.radius * (1 + count / 10000); 
                const radius = radiusFactor * maxRadius;

                const spinAngle = radius * parameters.spin;
                
                // Dallar arasÄ±nda rastgele daÄŸÄ±lÄ±m yerine, sÄ±ralÄ± daÄŸÄ±lÄ±m yaparak homojenlik saÄŸla
                // veya i'ye gÃ¶re dal seÃ§
                const branchAngle = (i % parameters.branches) / parameters.branches * Math.PI * 2;

                const randomX = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;
                const randomY = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;
                const randomZ = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;

                positions[i3    ] = Math.cos(branchAngle + spinAngle) * radius + randomX;
                positions[i3 + 1] = randomY / 2; 
                positions[i3 + 2] = Math.sin(branchAngle + spinAngle) * radius + randomZ;

                const mixedColor = colorInside.clone();
                mixedColor.lerp(colorOutside, radius / maxRadius);

                colors[i3    ] = mixedColor.r;
                colors[i3 + 1] = mixedColor.g;
                colors[i3 + 2] = mixedColor.b;

                // Birebir eÅŸleÅŸme: Her yÄ±ldÄ±z listenin o sÄ±rasÄ±ndaki kiÅŸidir
                nameIndices[i] = i;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            geometry.setAttribute('nameIndex', new THREE.BufferAttribute(nameIndices, 1));

            const material = new THREE.PointsMaterial({
                size: parameters.size,
                sizeAttenuation: true,
                depthWrite: false,
                blending: THREE.AdditiveBlending,
                vertexColors: true,
                map: createHeartTexture(),
                transparent: true,
                opacity: 0.8
            });

            points = new THREE.Points(geometry, material);
            scene.add(points);
        };

        // --- ETKÄ°LEÅÄ°M ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        raycaster.params.Points.threshold = 0.15;

        const tooltip = document.getElementById('tooltip');
        const tooltipName = document.getElementById('tooltip-name');
        const detailPanel = document.getElementById('detail-panel');
        const panelName = document.getElementById('panel-name');
        const panelDate = document.getElementById('panel-date');
        const closeBtn = document.getElementById('close-btn');
        const memoryInput = document.getElementById('memory-input');
        const saveBtn = document.getElementById('save-btn');
        const saveMsg = document.getElementById('save-msg');
        
        let currentHoverIndex = null;
        let currentSelectedName = null;

        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            tooltip.style.left = event.clientX + 'px';
            tooltip.style.top = event.clientY + 'px';
        });

        window.addEventListener('click', () => {
            if(currentHoverIndex !== null) openPanel(currentHoverIndex);
        });

        function openPanel(index) {
            controls.autoRotate = false;
            const nameIdx = geometry.attributes.nameIndex.array[index];
            const personData = namesList[nameIdx];
            const name = personData.name;
            currentSelectedName = name; 

            panelName.textContent = name;
            panelDate.textContent = personData.date || "Tarih Bilinmiyor";

            const savedNote = localStorage.getItem(`note_${name}`);
            memoryInput.value = savedNote ? savedNote : "";
            saveMsg.classList.add('hidden');
            detailPanel.classList.remove('translate-x-full');
        }

        closeBtn.addEventListener('click', () => {
            detailPanel.classList.add('translate-x-full');
            controls.autoRotate = true;
        });

        saveBtn.addEventListener('click', () => {
            if(currentSelectedName) {
                localStorage.setItem(`note_${currentSelectedName}`, memoryInput.value);
                saveMsg.classList.remove('hidden');
                setTimeout(() => saveMsg.classList.add('hidden'), 2000);
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        const tick = () => {
            if(points) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObject(points);
                if(intersects.length > 0) {
                    document.body.style.cursor = 'pointer';
                    const index = intersects[0].index;
                    currentHoverIndex = index;
                    const nameIdx = geometry.attributes.nameIndex.array[index];
                    tooltipName.textContent = namesList[nameIdx].name;
                    tooltip.classList.remove('hidden');
                } else {
                    document.body.style.cursor = 'default';
                    currentHoverIndex = null;
                    tooltip.classList.add('hidden');
                }
            }
            controls.update();
            renderer.render(scene, camera);
            window.requestAnimationFrame(tick);
        };

        fetchNames();
        tick();
    </script>
</body>
</html>
