<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sönmeyen Yıldızlar - Dijital Anıt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- İkonlar için FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; overflow: hidden; background-color: #050000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        
        #tooltip { pointer-events: none; transform: translate(-50%, -150%); z-index: 40; }
        
        #loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #050000; z-index: 50; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 1s ease;
        }

        /* Panel içindeki detay satırları için stil */
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .detail-label { color: #9ca3af; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; }
        .detail-value { color: #f3f4f6; font-weight: 500; font-size: 0.9rem; text-align: right; max-width: 60%; }
    </style>
</head>
<body class="antialiased text-gray-100">

    <canvas id="webgl" class="absolute top-0 left-0 w-full h-full z-0"></canvas>

    <!-- Yükleme Ekranı -->
    <div id="loading-overlay">
        <div class="w-16 h-16 border-4 border-red-900 border-t-pink-500 rounded-full animate-spin mb-4"></div>
        <p class="text-pink-300 text-sm tracking-widest animate-pulse">VERİLER ÇEKİLİYOR...</p>
    </div>

    <div class="relative z-10 pointer-events-none w-full h-screen">
        
        <!-- Sol Üst Başlık -->
        <div class="absolute top-0 left-0 p-8 pointer-events-auto">
            <h1 class="text-4xl font-light tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-red-600 drop-shadow-lg">
                SÖNMEYEN YILDIZLAR
            </h1>
            <p class="mt-2 text-sm text-red-100 opacity-70 max-w-md font-light">
                Her bir yıldız, aramızdan koparılan bir ışığı temsil eder. <br>
                Toplam <span id="total-count" class="font-bold text-white">...</span> can sonsuzluğa karıştı.
                <br><br>
                <span class="text-xs italic text-gray-500">Galakside gezinmek için sürükleyin, detaylar için tıklayın.</span>
            </p>
        </div>

        <!-- Tooltip -->
        <div id="tooltip" class="absolute hidden bg-black/90 border border-red-500/30 backdrop-blur px-4 py-2 rounded-lg shadow-[0_0_20px_rgba(255,0,0,0.3)] transition-opacity duration-200">
            <span id="tooltip-name" class="font-bold text-pink-200 text-lg block">İsim</span>
            <span id="tooltip-date" class="text-xs text-gray-400 block text-center mt-1">Tarih</span>
        </div>

        <!-- Detay Paneli -->
        <div id="detail-panel" class="absolute top-0 right-0 h-full w-full md:w-[450px] bg-[#0a0505]/95 backdrop-blur-xl border-l border-red-900/30 shadow-2xl pointer-events-auto transform transition-transform duration-500 translate-x-full flex flex-col">
            
            <button id="close-btn" class="absolute top-4 right-4 text-white/50 hover:text-white text-2xl z-20">&times;</button>

            <div class="p-8 flex-1 overflow-y-auto relative">
                <!-- Profil Bölümü -->
                <div class="flex flex-col items-center mt-4 mb-6">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-b from-pink-600 to-red-900 p-[2px] shadow-[0_0_30px_rgba(220,20,60,0.4)]">
                        <div class="w-full h-full bg-black rounded-full flex items-center justify-center">
                            <i class="fa-solid fa-dove text-2xl text-white/90"></i>
                        </div>
                    </div>
                    <h2 id="panel-name" class="mt-4 text-2xl font-bold text-center text-white">İsim Soyisim</h2>
                    <p id="panel-date-head" class="text-sm text-pink-400 uppercase tracking-wider font-medium">01.01.2024</p>
                </div>

                <!-- Detaylar Listesi -->
                <div class="bg-white/5 rounded-xl p-5 border border-white/5 mb-6">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-3">Olay Detayları</h3>
                    
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-location-dot w-4"></i> İl / İlçe</span>
                        <span id="det-location" class="detail-value">...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-hourglass-half w-4"></i> Yaş</span>
                        <span id="det-age" class="detail-value">...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-skull w-4"></i> Fail</span>
                        <span id="det-killer" class="detail-value text-red-300">...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-question w-4"></i> Neden</span>
                        <span id="det-reason" class="detail-value">...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-gun w-4"></i> Şekil</span>
                        <span id="det-method" class="detail-value">...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fa-solid fa-shield-halved w-4"></i> Koruma</span>
                        <span id="det-protection" class="detail-value">...</span>
                    </div>
                    <div class="detail-row border-none">
                        <span class="detail-label"><i class="fa-solid fa-gavel w-4"></i> Fail Durumu</span>
                        <span id="det-status" class="detail-value">...</span>
                    </div>
                </div>

                <!-- Kaynak Butonu -->
                <a id="source-link" href="#" target="_blank" class="flex items-center justify-center gap-2 w-full py-2 mb-6 bg-gray-800/50 hover:bg-gray-800 text-gray-400 text-xs rounded transition-colors hidden">
                    <i class="fa-solid fa-link"></i> Haberi / Kaynağı Görüntüle
                </a>

                <hr class="border-white/10 mb-6">

                <!-- Anı Defteri -->
                <div>
                    <h3 class="text-lg font-medium text-pink-300 mb-2 flex items-center gap-2">
                        <i class="fa-solid fa-pen-nib"></i> Anı Defteri
                    </h3>
                    <p class="text-xs text-gray-500 mb-3">Bu kişi için dijital bir not bırakın (Sadece siz görebilirsiniz).</p>
                    
                    <textarea id="memory-input" rows="4" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-sm text-white focus:outline-none focus:border-pink-500/50 transition-colors resize-none placeholder-gray-600" placeholder="Bir şeyler yazın..."></textarea>
                    
                    <div class="flex justify-end mt-3">
                        <button id="save-btn" class="px-5 py-2 bg-gradient-to-r from-red-900 to-pink-800 hover:from-red-800 hover:to-pink-700 text-white text-xs font-bold rounded shadow-lg transition-all active:scale-95">
                            KAYDET
                        </button>
                    </div>
                    <p id="save-msg" class="text-xs text-green-400 mt-2 text-right hidden">Kaydedildi.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let namesList = []; 

        // --- VERİ ÇEKME ---
        async function fetchNames() {
            try {
                const response = await fetch('anit_verileri.json');
                if (!response.ok) throw new Error('Veri yok');
                namesList = await response.json();
                
                document.getElementById('total-count').innerText = namesList.length.toLocaleString();
                generateGalaxy();
                
                const loading = document.getElementById('loading-overlay');
                loading.style.opacity = '0';
                setTimeout(() => loading.style.display = 'none', 1000);

            } catch (error) {
                console.warn("Yedek veri kullanılıyor.", error);
                // Hata durumunda basit yedek veri
                namesList = [{name: "Veri Yüklenemedi", date: "...", location: "...", killer: "..."}];
                generateGalaxy();
                document.getElementById('loading-overlay').style.display = 'none';
            }
        }

        function createHeartTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.moveTo(16, 28); ctx.bezierCurveTo(16, 26, 4, 18, 4, 12);
            ctx.bezierCurveTo(4, 6, 10, 4, 16, 10); ctx.bezierCurveTo(22, 4, 28, 6, 28, 12);
            ctx.bezierCurveTo(28, 18, 16, 26, 16, 28);
            ctx.fill();
            ctx.shadowBlur = 4; ctx.shadowColor = "white"; ctx.fill();
            return new THREE.CanvasTexture(canvas);
        }

        // --- THREE.JS SETUP ---
        const canvas = document.querySelector('canvas.webgl');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2('#050000', 0.03);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 4, 8);

        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('webgl'), alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.autoRotate = true; controls.autoRotateSpeed = 0.5;

        // --- GALAKSİ ---
        const parameters = {
            size: 0.15, radius: 8, branches: 4, spin: 1.2, 
            randomness: 0.5, randomnessPower: 3,
            insideColor: '#ffc0cb', outsideColor: '#8a0000'
        };

        let geometry = null;
        let points = null;

        const generateGalaxy = () => {
            if(namesList.length === 0) return;
            const count = namesList.length;

            geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const nameIndices = new Float32Array(count);

            const colorInside = new THREE.Color(parameters.insideColor);
            const colorOutside = new THREE.Color(parameters.outsideColor);

            for(let i = 0; i < count; i++) {
                const i3 = i * 3;
                // Merkezden dışa büyüme
                const radiusFactor = Math.pow(i / count, 0.7);
                const maxRadius = parameters.radius * (1 + count / 8000);
                const radius = radiusFactor * maxRadius;

                const spinAngle = radius * parameters.spin;
                const branchAngle = (i % parameters.branches) / parameters.branches * Math.PI * 2;

                const randomX = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;
                const randomY = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;
                const randomZ = Math.pow(Math.random(), parameters.randomnessPower) * (Math.random() < 0.5 ? 1 : -1) * parameters.randomness * radius;

                positions[i3] = Math.cos(branchAngle + spinAngle) * radius + randomX;
                positions[i3 + 1] = randomY / 2;
                positions[i3 + 2] = Math.sin(branchAngle + spinAngle) * radius + randomZ;

                const mixedColor = colorInside.clone();
                mixedColor.lerp(colorOutside, radius / maxRadius);

                colors[i3] = mixedColor.r;
                colors[i3 + 1] = mixedColor.g;
                colors[i3 + 2] = mixedColor.b;

                nameIndices[i] = i;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            geometry.setAttribute('nameIndex', new THREE.BufferAttribute(nameIndices, 1));

            const material = new THREE.PointsMaterial({
                size: parameters.size, sizeAttenuation: true, depthWrite: false,
                blending: THREE.AdditiveBlending, vertexColors: true,
                map: createHeartTexture(), transparent: true, opacity: 0.8
            });

            points = new THREE.Points(geometry, material);
            scene.add(points);
        };

        // --- UI ETKİLEŞİMİ ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        raycaster.params.Points.threshold = 0.15;

        const tooltip = document.getElementById('tooltip');
        const detailPanel = document.getElementById('detail-panel');
        
        // Panel Elemanları
        const els = {
            name: document.getElementById('panel-name'),
            dateHead: document.getElementById('panel-date-head'),
            location: document.getElementById('det-location'),
            age: document.getElementById('det-age'),
            killer: document.getElementById('det-killer'),
            reason: document.getElementById('det-reason'),
            method: document.getElementById('det-method'),
            protection: document.getElementById('det-protection'),
            status: document.getElementById('det-status'),
            sourceLink: document.getElementById('source-link'),
            input: document.getElementById('memory-input'),
            saveMsg: document.getElementById('save-msg')
        };

        let currentHoverIndex = null;
        let currentSelectedName = null;

        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            tooltip.style.left = event.clientX + 'px';
            tooltip.style.top = event.clientY + 'px';
        });

        window.addEventListener('click', (e) => {
            // Panele tıklayınca kapanmasın
            if(e.target.closest('#detail-panel')) return;
            
            if(currentHoverIndex !== null) openPanel(currentHoverIndex);
        });

        function openPanel(index) {
            controls.autoRotate = false;
            const nameIdx = geometry.attributes.nameIndex.array[index];
            const person = namesList[nameIdx];
            currentSelectedName = person.name;

            // Verileri Doldur
            els.name.innerText = person.name;
            els.dateHead.innerText = person.date || "Tarih Yok";
            els.location.innerText = person.location || "Bilinmiyor";
            els.age.innerText = person.age || "Bilinmiyor";
            els.killer.innerText = person.killer || "Bilinmiyor";
            els.reason.innerText = person.reason || "Bilinmiyor";
            els.method.innerText = person.method || "Bilinmiyor";
            els.protection.innerText = person.protection || "Yok";
            els.status.innerText = person.status || "Bilinmiyor";

            // Kaynak Linki
            if(person.source && person.source.startsWith('http')) {
                els.sourceLink.href = person.source;
                els.sourceLink.classList.remove('hidden');
            } else {
                els.sourceLink.classList.add('hidden');
            }

            // Anı Defteri
            els.input.value = localStorage.getItem(`note_${person.name}`) || "";
            els.saveMsg.classList.add('hidden');

            detailPanel.classList.remove('translate-x-full');
        }

        document.getElementById('close-btn').addEventListener('click', () => {
            detailPanel.classList.add('translate-x-full');
            controls.autoRotate = true;
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            if(currentSelectedName) {
                localStorage.setItem(`note_${currentSelectedName}`, els.input.value);
                els.saveMsg.classList.remove('hidden');
                setTimeout(() => els.saveMsg.classList.add('hidden'), 2000);
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        const tick = () => {
            if(points) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObject(points);
                if(intersects.length > 0) {
                    document.body.style.cursor = 'pointer';
                    const idx = intersects[0].index;
                    currentHoverIndex = idx;
                    
                    const person = namesList[geometry.attributes.nameIndex.array[idx]];
                    document.getElementById('tooltip-name').innerText = person.name;
                    document.getElementById('tooltip-date').innerText = person.date || "";
                    tooltip.classList.remove('hidden');
                } else {
                    document.body.style.cursor = 'default';
                    currentHoverIndex = null;
                    tooltip.classList.add('hidden');
                }
            }
            controls.update();
            renderer.render(scene, camera);
            window.requestAnimationFrame(tick);
        };

        fetchNames();
        tick();
    </script>
</body>
</html>
